<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-pesquisa/wireguard" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.3">
<title data-rh="true">Wireguard Whitepaper | Wireguard Based Private and Secure Overlay Network</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://your-docusaurus-test-site.com/thesis-web/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://your-docusaurus-test-site.com/thesis-web/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://your-docusaurus-test-site.com/thesis-web/docs/pesquisa/wireguard"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Wireguard Whitepaper | Wireguard Based Private and Secure Overlay Network"><meta data-rh="true" name="description" content="Titulo Next Generation Kernel Network Tunnel"><meta data-rh="true" property="og:description" content="Titulo Next Generation Kernel Network Tunnel"><link data-rh="true" rel="icon" href="/thesis-web/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://your-docusaurus-test-site.com/thesis-web/docs/pesquisa/wireguard"><link data-rh="true" rel="alternate" href="https://your-docusaurus-test-site.com/thesis-web/docs/pesquisa/wireguard" hreflang="en"><link data-rh="true" rel="alternate" href="https://your-docusaurus-test-site.com/thesis-web/docs/pesquisa/wireguard" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/thesis-web/blog/rss.xml" title="Wireguard Based Private and Secure Overlay Network RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/thesis-web/blog/atom.xml" title="Wireguard Based Private and Secure Overlay Network Atom Feed"><link rel="stylesheet" href="/thesis-web/assets/css/styles.acd1c992.css">
<link rel="preload" href="/thesis-web/assets/js/runtime~main.843aa213.js" as="script">
<link rel="preload" href="/thesis-web/assets/js/main.74e24612.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/thesis-web/"><div class="navbar__logo"><img src="/thesis-web/img/deti.png" alt="My Site Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/thesis-web/img/deti.png" alt="My Site Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/thesis-web/docs/intro">About</a><a class="navbar__item navbar__link" href="/thesis-web/docs/category/portefolio">Portefolio</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/VascoRegal/msc-thesis" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/thesis-web/docs/intro">Introdução</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/thesis-web/docs/category/portefolio">Portefolio</a><button aria-label="Toggle the collapsible sidebar category &#x27;Portefolio&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/thesis-web/docs/category/pesquisa">Pesquisa</a><button aria-label="Toggle the collapsible sidebar category &#x27;Pesquisa&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/thesis-web/docs/pesquisa/wireguard">Wireguard Whitepaper</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/thesis-web/docs/ficha_técnica">Ficha Técnica</a></li></ul></nav></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/thesis-web/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/thesis-web/docs/category/pesquisa"><span itemprop="name">Pesquisa</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Wireguard Whitepaper</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Wireguard Whitepaper</h1><p><strong>Titulo:</strong> WireGuard: Next Generation Kernel Network Tunnel</p><p><strong>Autor:</strong> Jason A. Donenfeld</p><p><strong>URL:</strong> <a href="https://www.wireguard.com/papers/wireguard.pdf" target="_blank" rel="noopener noreferrer">https://www.wireguard.com/papers/wireguard.pdf</a></p><hr><h2 class="anchor anchorWithStickyNavbar_LWe7" id="wireguard">WireGuard<a href="#wireguard" class="hash-link" aria-label="Direct link to WireGuard" title="Direct link to WireGuard">​</a></h2><ul><li><strong>Layer 3</strong> (network / packets) network tunnel implemented at <strong>kernel level</strong></li><li>Tunnel works by associating peers with a <strong>public key</strong> and a <strong>source IP</strong></li><li>OpenSSH style mutual authentication</li><li>As it uses UDP, <strong>sessions are managed transparently</strong> with state machines</li></ul><hr><h3 class="anchor anchorWithStickyNavbar_LWe7" id="cryptokey-routing">Cryptokey routing<a href="#cryptokey-routing" class="hash-link" aria-label="Direct link to Cryptokey routing" title="Direct link to Cryptokey routing">​</a></h3><ul><li>Peers are identified by a <strong>public key</strong> - a 32 byte Curve25519.</li><li>Each interface keeps a data structure with its own public and private keys, listening port and a <strong>list of public key / allowed source ips</strong> associations for each peer</li><li>Optionally, peers can also <strong>define an internet endpoint</strong>, to where it is listening for packets. If not defined, wireguard uses the incoming packets’ source IP</li><li>An <strong>outgoing wireguard packet</strong> will <strong>consult the table</strong> and use the respective IP’s public key for encryption</li><li>An <strong>incoming packet</strong>, after being decrypted will only be accepted if there’s a match, after decryption, between the source IP and the allowed IPs in the table.</li></ul><p><img loading="lazy" alt="Untitled" src="/thesis-web/assets/images/Untitled-04e96d7f056b65ffe957a66323c68ab6.png" width="615" height="133" class="img_ev3q"></p><hr><h3 class="anchor anchorWithStickyNavbar_LWe7" id="send--recv-flow">Send / Recv flow<a href="#send--recv-flow" class="hash-link" aria-label="Direct link to Send / Recv flow" title="Direct link to Send / Recv flow">​</a></h3><p><strong>Send</strong></p><ol><li>plain text reaches the wg interface</li><li><strong>destination IP</strong> is consulted from the routing table</li><li>plain text is encrypted with the peer’s public key and nouce counter, using ChaCha20Poly1305</li><li><strong>Wireguard headers</strong> are added to the encrypted package</li><li>The header + encrypted packet are sent as a <strong>UDP/IP packet to the peer’s endpoint</strong> (either peer defined or determined by the last received authentication packet from destination peer)</li></ol><p><strong>Recv</strong></p><ol><li>The header + encrypted UDP packet reaches the wg interface</li><li>By reading the header, WireGuard identifies the peer associated with the packet, checks the validity of the counter and <strong>perfroms authentication and decryption</strong>.</li><li>The source IP in the packet is used to <strong>update the peer’s endpoint</strong></li><li>After decryption, wireguard checks <strong>if the source IP matches the allowed IPs</strong> from the source peer. If not, it is dropped.</li><li>Plain text packet is <strong>inserted in the wg queue</strong></li></ol><hr><h3 class="anchor anchorWithStickyNavbar_LWe7" id="protocol-and-cryptography">Protocol and Cryptography<a href="#protocol-and-cryptography" class="hash-link" aria-label="Direct link to Protocol and Cryptography" title="Direct link to Protocol and Cryptography">​</a></h3><p>Before any encrypted communication, wireguard <strong>enforces a 1-RTT handshake for symmetric key exchange</strong> - one for sending and one for receiving.</p><p>Only after the initiator send an encrypted message will the receiver be able to start sending encrypted messages.</p><p>This ordering restriction is to require confirmation as described for KEA+C, as well as allowing handshake message to be processed asynchronously to transport data messages. </p><p>These messages use the “IK” pattern from Noise, in addition to a novel cookie construction to mitigate denial of service attacks. </p><p>One characteristic of wireguard is its <strong>Silence</strong> - which means that wireguard is invisible to ilegitimate peers and network packets, since these packets are just dropped.</p><p>To prevent an attacker to interfere with sessions (for example, by sending multiple session initiating messages to peer to force key regeneration), wireguard provides a timestamp, a 12-byte TAI64N - encrypted and authenticated - in the first message by the initiator. The receiver will keep track of this value, and discard packets with timestamp values lesser or equal than the registered.</p><p>This first message relies only the Diffie-Helman result of both peers keys. If one is compromised, an attacker could forge an initiating message - but could not complete the handshake.</p><p><strong>Optional pre-shared symmetric key mode</strong></p><p>Peers can add an extra layer of encryption - a single 256-bit symmetric encryption key. This extra layer assumes the cracking of the Curve2551 - which is a process, at the time of writting, that requires capture of a substantial ammount of traffic.</p><p><strong>Denial of Service mitigation</strong></p><p>To determine the authenticity of handshake message, a Curve25519 multiplication must be computed, requiring considerable CPU usage.</p><p>This could allow for an attack vector by cpu-exhausting. Hence, if under load, a receiver may reply with a cookie - which the initiator will then use on its initiating message to proceed with the handshake.</p><hr><h3 class="anchor anchorWithStickyNavbar_LWe7" id="messages">Messages<a href="#messages" class="hash-link" aria-label="Direct link to Messages" title="Direct link to Messages">​</a></h3><ul><li>Handshake initiation</li><li>Handshake response</li><li>Cookie message - reply to handshake initiation or response with a cookie to resend messages</li><li>Encrypted IP Packet using negotiatied ciphers in the handshake</li></ul><p><strong>i →</strong> initiator</p><p><strong>r →</strong> responder</p><p>Both peers hold a structure with such variables:</p><p><img loading="lazy" alt="Untitled" src="/thesis-web/assets/images/Untitled 1-3da7282a115a434e80efc16c6b6088ce.png" width="1282" height="272" class="img_ev3q"></p><p>The handshake executes as following:</p><p><img loading="lazy" alt="Untitled" src="/thesis-web/assets/images/Untitled 2-4c96ad6e8749f052afad42794e43fb9b.png" width="1306" height="763" class="img_ev3q"></p><hr><h3 class="anchor anchorWithStickyNavbar_LWe7" id="timers-and-stateless-ux">Timers and Stateless UX<a href="#timers-and-stateless-ux" class="hash-link" aria-label="Direct link to Timers and Stateless UX" title="Direct link to Timers and Stateless UX">​</a></h3><ul><li>Wireguard manages session state using methods transparent to the user.</li><li>Employs a tested, robust state machine, due to the simplicity of a 1-RTT</li></ul><p>For this process, wireguard keeps the following constants:</p><p><img loading="lazy" alt="Untitled" src="/thesis-web/assets/images/Untitled 3-aae39466a1a31ac46001d762a021f5db.png" width="666" height="292" class="img_ev3q"></p><ul><li>Wireguard will not send initiation messages more than once every <strong>REKEY-TIMEOUT</strong></li><li>Reinitiations are attempted for <strong>REKEY-ATTEMPT-TIME</strong> seconds. The process restarts after this timeout when the initiator wants to send a new data packet.</li><li>When an initiation message is sent due to end of timer, a small ammount of jitter is added so they don’t do it simultaneously</li><li>After <strong>REKEY-AFTER-MESSAGES</strong> messages, WireGuard will start a new initiation process</li><li>After <strong>REJECT-AFTER-MESSAGES</strong> transport data messages or after the current secure session is <strong>REJECT-AFTER-TIME</strong> seconds old, whichever comes first, WireGuard will refuse to send or receive any more transport data until a new session is created.</li></ul><p><strong>Key Rotation</strong></p><p>WireGuard keeps in memory the current secure session, the previous secure session, and the next secure session for the case of an unconfirmed session. Every time a new secure session is created, the existing one rotates into the “previous” slot, and the new one occupies the “current” slot, for the initiator, and for the responder, the “next” slot is used interstitially until the handshake is confirmed</p><p><strong>Keepalive</strong></p><ul><li>If a peer receives a data message but has nothing to reply within the <strong>KEEPALIVE-TIMEOUT</strong> seconds, it will send a zero-length keepalive packets to maintain the session.</li><li>Hence, wireguard considers a session broken if it has not received a data message or a keepalive within <strong>KEEPALIVE-TIMEOUT</strong> + <strong>REKEY-TIMEOUT</strong> seconds</li></ul><p><strong>interaction with cookie system</strong></p><ul><li>Upon receiving a cookie to prceed with the handshake later, the peer should only send the initiating with the handshake message after <strong>REKEY-TIMEOUT</strong></li></ul></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/thesis-web/docs/category/pesquisa"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Pesquisa</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/thesis-web/docs/ficha_técnica"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Ficha Técnica</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#wireguard" class="table-of-contents__link toc-highlight">WireGuard</a><ul><li><a href="#cryptokey-routing" class="table-of-contents__link toc-highlight">Cryptokey routing</a></li><li><a href="#send--recv-flow" class="table-of-contents__link toc-highlight">Send / Recv flow</a></li><li><a href="#protocol-and-cryptography" class="table-of-contents__link toc-highlight">Protocol and Cryptography</a></li><li><a href="#messages" class="table-of-contents__link toc-highlight">Messages</a></li><li><a href="#timers-and-stateless-ux" class="table-of-contents__link toc-highlight">Timers and Stateless UX</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 Built with Docusaurus.</div></div></div></footer></div>
<script src="/thesis-web/assets/js/runtime~main.843aa213.js"></script>
<script src="/thesis-web/assets/js/main.74e24612.js"></script>
</body>
</html>